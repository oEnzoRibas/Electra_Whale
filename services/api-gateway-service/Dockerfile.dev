# Dockerfile.dev para API Gateway (Node.js)

FROM node:20-alpine

WORKDIR /app

RUN apk add --no-cache bash inotify-tools

# 1. Copiar arquivos de dependências (Contexto na raiz ..)
COPY services/api-gateway-service/package*.json ./
COPY services/api-gateway-service/tsconfig.json ./

# 2. Executar o npm ci para garantir integridade total
RUN npm install

# 3. Copiar o código do serviço
COPY services/api-gateway-service/ .

# 4. Permissões de Scripts
RUN chmod +x ./wait-for-it.sh
RUN find /app -type f -name "*.sh" -exec chmod +x {} \;

EXPOSE 8080

# O Gateway depende dos serviços, mas aqui espera o postgres por segurança/padrão
CMD ["sh", "-c", "./wait-for-it.sh auth-service:3000 -- npm run dev"]